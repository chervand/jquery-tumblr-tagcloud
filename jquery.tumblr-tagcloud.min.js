(function(a){a.fn.tumblrTagCloud=function(p){var e=a.extend({numPosts:50,maxPosts:400,sortBy:false,username:false,password:false},p),k=null,d=[],l={},h=[],n=[],c=0,b=0,o="",g;function m(){k.html("Loading... ");a.ajax({url:e.url+"/api/read?num="+e.numPosts+"&start="+e.postCount,dataType:"xml",username:e.username||false,password:e.password||false,success:j,error:function(){k.append("<span>unable to query tag list.</span>")}})}function j(i){k.empty();tags=i.getElementsByTagName("tag");n=i.getElementsByTagName("posts");c=n[0].getAttribute("total")-0;for(g=0;g<tags.length;g++){o=tags[g].textContent.replace(" ","");if(l[o]){d[l[o]].count++}else{l[o]=d.length;d.push({count:1,normalized:o,original:tags[g].textContent})}}if(b<Math.min(c,e.maxPosts)){b+=50;m()}else{f()}}function f(){if(e.sortBy==="alpha"){h=d.sort(function(q,i){return q.normalized.localeCompare(i.normalized)})}else{if(e.sortBy==="bycount"){h=d.sort(function(q,i){return i.count-q.count})}else{if(e.sortBy==="random"){h=d.sort(function(q,i){return Math.round(Math.random())-0.5})}else{a.extend(true,h,d)}}}k.empty();jQuery.each(h,function(i,q){k.append(jQuery("<a>").attr({href:"#"+q.original,title:q.original+"["+q.count+"]"}).css("font-size",100+q.count+"%").html(q.original))})}return this.each(function(){k=a(this);m()})}})(jQuery);